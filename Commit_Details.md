# Commit Details

It seems the Check-ins to the repo have way too many minor, major, and cosmetic
changes, so the limited comment line really does not cover what has changed.
Starting with Commit 76 on 11/22/2020 , I will try and do better, and keep track of what is going on in this file.


## Commit \#76 11/22/2020

Changes:
-   Locked which version of **SdFat** and **FastLed** libraries are used in platformio.ini lib_deps section
-   Moved the Boot Log output to the Poll Loop, improvements to how it is displayed
-   Improved handling of SD Card if it is not installed
-   Fix to HPIBOutput()
-   SDREN re-write
-   Minimal Verbose reporting added to all Keywords. More to come.
-   Improvements to the built-in Logic Analyzer output formatting
-   Resolve_Path() now trims leading and trailing spaces from the new path
-   Many minor documentation improvements in about 12 files
-   TXD diagnostic signal is now pulsed by the built-in Logic Analyzer to trigger
    an external Logic Analyzer. This allows comparison of the two Logic Analyzers,
    and the built-in Logic Analyzer now has time stamps on all sample to
    facilitate this capability. This needs to be made conditional so that TXD can be used for other diagnostic purposes
-   A deliberate glitch in the RXD diagnostic signal used to separate Phi 1
    from Phi 2 interrupt processing has been removed, as it contributed a
    minor additional delay to the RC signal.
-   Moved the built-in Logic Analyzer code in Phi 2 processing to after RC
    is asserted, thus reducing the delay to the start of RC. There is more
    work to be done on this front.
-   Started adding support for HP86/86 type ROMs, and the special ROM headers
    for the Secondary AUXROMs.
-   Minor bug fixed in the built-in Logic Analyzer if Ctrl-C was used to end
    the prior acquisition. Affected re-issuing `la go` without doing a new `la setup`
-   With the recent acquisition of a better external Logic analyzer, documented
    the new probing arrangement: `Logic Analyzer Configuration 6 for TLA5201`

### What's going on

There has been an ongoing search for what is causing random failures of the
status reported by the SDREN (rename a file on the SD Card, including changing
the path). The command always does as intended (assuming correct parameters)
but can report either that the command failed, or even a general SD error.
It appears that the issue is the timing of the RC signal has a late start.
The current working theory is that something in the SdFat library, or the
SDIO library that it depends on is delaying the start of RC being asserted,
possibly due to DMA activity on the Teensy 4.1  . Yet other commands that do
reads and writes to the SD card do not show the problem to the same extent.
This commit rearranged some of the code in the Phi 2 processing (were RC is
controlled) seems to have mitigated the issue but further work is required
to achieve a better level of confidence.

Oscilloscope captures still indicate the RC signal generated by EBTKS still
violates timing spec Tif2 (380 ns max) from the 1MB5 spec, by 100 ns.

Fixing this will involve the most of the timing critical code in
`   EBTKS_Bus_Interface_ISR.cpp`

One of the attempted workarounds was to put the HP85 into DMA hold while
this statement executed:
`   rename_status = SD.rename(Resolved_Old_Path, Resolved_Path);`

yet even this failed, casting doubt on the above theory of the root cause
of the problem.

Another experiment involved moving the storage for all the ROMs from DMAMEM
to FASTRUN memory. It only had a minor effect on the issue. This should be
tried again after other experiments have been tried and implemented.

## Commit \#77 11/23/2020

Changes:
-   Modify MOUNT for tape and disk when the media needs to be created. Now uses
    a shared copy function that is also used for SDCOPY.
-   Implemented SDCOPY



